version: '3'

services:

  kv:
    restart: always
    container_name: art-kv
    build:
      context: ../../docker/kvrocks
      dockerfile: Dockerfile
    # mem_limit: 1G
    environment:
      KVROCKS_ARGS: |
        --port ${KV_PORT}
        --requirepass ${KV_PASSWORD}
        --workers ${KV_WORKERS}
        --log /log
        --dir /data
        --timeout 360
        --rocksdb.compression zstd
        --rocksdb.enable_blob_files yes
        --rocksdb.read_options.async_io yes
    volumes:
      - ./data/kv:/data
      - ./log/kv:/log
    ports:
      - ${KV_PORT}:${KV_PORT}

  # gdb:
  #   container_name: art-gdb
  #   image: greptime/greptimedb:v0.4.0-nightly-20230821
  #   # image: greptime/greptimedb
  #   ports:
  #     - 4000-4005:4000-4005
  #   command: >
  #     standalone start
  #     --storage-type s3
  #     --storage-bucket ${GDB_S3_BUCKET}
  #     --storage-root ${GDB_S3_ROOT}
  #     --storage-access_key_id ${GDB_S3_ACCESS_KEY}
  #     --storage-secret_access_key = ${GDB_S3_SECRET}
  #     --storage-cache_path ./cache/gdb
  #     --storage-cache_capacity = 1024
  #     --http-addr 0.0.0.0:4000
  #     --rpc-addr 0.0.0.0:4001
  #     --mysql-addr 0.0.0.0:4002
  #     --postgres-addr 0.0.0.0:4003
  #     --prom-addr 0.0.0.0:4004
  #     --opentsdb-addr 0.0.0.0:4005
  #     --user-provider=static_user_provider:file:/user.ini
  #   volumes:
  #     - ./cache/gdb:./cache/gdb
  #     - ./gdb/user.ini:/user.ini
  #
